FROM node:16-alpine

RUN apk update

## Fix security issue node < 16
## ERROR: http://dl-cdn.alpinelinux.org/alpine/v3.11/main: BAD signature
RUN sed -i -e 's/http:/https:/' /etc/apk/repositories

RUN apk update && apk add curl

WORKDIR /common

RUN apk --update add postgresql-client

COPY package.json package.json
COPY yarn.lock yarn.lock

RUN yarn install --silent

COPY . .

RUN chmod 100 ./ci/migration.sh
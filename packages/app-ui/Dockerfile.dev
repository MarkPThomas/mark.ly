FROM node:16-alpine as uiBuild

WORKDIR /app-ui

COPY ./app-ui/package.json /app-ui/package.json
COPY ./app-ui/yarn.lock /app-ui/yarn.lock

RUN yarn install --silent

COPY ./app-ui .

RUN yarn ui:build && cd -


FROM node:16-alpine

WORKDIR /app-ui/server

COPY ./app-ui/server/package.json package.json
COPY ./app-ui/server/yarn.lock yarn.lock

RUN yarn install --silent

COPY ./app-ui/server .

COPY --from=uiBuild /app-ui/build /app-ui/build

CMD yarn server:dev